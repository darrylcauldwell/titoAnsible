formatVersion: 1
inputs:
  ansible-key:
    type: string
    default: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC5LoFaZVRc7GLlelP/l6Iv3UUKx6iYowb3WfS6Dk+ziDgGjlFruJnqMTZxAsoKhZeHPAKP0FOC95kv6AGkeWm5+rbvszolIIF22oj7nOkpZVXKwCXrhw81kDje3fl1XXn1CjylnysVyql5f0Ipay9fdUOBypFh1s3KdRvRYAVSxa7NEjgQgGJMxWlVXZXYbFcTdDEQZ+OM/Pz3bXGpS2K7KkcioPg6iqtMqO3/s0mJn2NVXLlfTEiGUD4VF8UCneAOSaqOih/H/Ii9sv0vAYnNeGQd6WD6sL8nCKqtcoU+u+6QYWTVgUaJ1T+GgjOcbW5HPaxr/C8WoajWIGnZTLGh root@ansibleServer-mcm679349-112967850675.darrylcauldwell.com
    title: Ansible public SSH key
resources:
  ansibleClient:
    type: Cloud.Machine
    properties:
      image: ansibleCentOS76
      flavor: ansibleMedium
      cloudConfig: |
        #cloud-config
        output: {all: '| tee -a /var/log/cloud-init-output.log'}
        runcmd:
        - useradd -m -d /home/ansible -s /bin/bash ansible
        - mkdir /home/ansible/.ssh
        - touch /home/ansible/.ssh/authorization_keys
        - echo '${input.ansible-key}' >> /home/ansible/.ssh/authorized_keys
        - echo 'ansible ALL=(ALL) NOPASSWD:ALL' >> /etc/sudoers
        - echo 'Defaults:ansible !requiretty' >> /etc/sudoers
        - usermod --groups wheel ansible
      networks:
        - network: '${resource.net.id}'
  net:
    type: Cloud.Network
    properties:
      networkType: existing
