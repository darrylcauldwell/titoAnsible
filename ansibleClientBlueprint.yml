formatVersion: 1
inputs:
  ansible-key:
    type: string
    default: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDRZ/WLSW+e17RTIFkYotQ0iNJCPNKpaat9zZ11wZDzqoydhOo7t+1VdQy52ptmsKwpKgdAcwf7rrk6WAp59o8YbDVqzzi+VuHnNn9REBKMvDlemQJi/0JCh/lMhVke/LpEPNLCCWy/t4R8p0HMj9FCi24UmQW2hZDWwv1bTOvqxclrrAAIuD6APKD/xoNmuhTLDLwi2emfd/IL5DchDL1xmSd5+XoNc1Kaa9MXB0c1nxJix0ivbMhR8rs32BMD6x7LgLfGegjohUTmSaY4HQxfWev/Z5HBv2SDdocaVrbD6+fn4Noi+oewl+t66T3B9YmUBWCX8D1JVyjXB2e1khVj root@ansibleServer-mcm674411-112809240447.darrylcauldwell.com
    title: Ansible public SSH key
resources:
  ansibleClient:
    type: Cloud.Machine
    properties:
      image: potterCentOS76
      flavor: potterSmall
      cloudConfig: |
        #cloud-config
        output: {all: '| tee -a /var/log/cloud-init-output.log'}
        runcmd:
        - useradd -m -d /home/ansible -s /bin/bash ansible
        - mkdir /home/ansible/.ssh
        - touch /home/ansible/.ssh/authorization_keys
        - echo '${input.ansible-key}' >> /home/ansible/.ssh/authorized_keys
        - echo 'myuser ALL=(ALL) NOPASSWD:ALL' >> /etc/sudoers
        - usermod --groups wheel ansible
      networks:
        - network: '${resource.net.id}'
  net:
    type: Cloud.Network
    properties:
      networkType: existing
