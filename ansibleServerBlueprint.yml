formatVersion: 1
name: ansibleServer
inputs:
  cloud:
    type: string
    enum:
      - 'cloud:vsphere'
    default: 'cloud:vsphere'
    title: Cloud
    description: Target Cloud
  env:
    type: string
    enum:
      - 'env:home-dc'
    default: 'env:home-dc'
    title: Environment
    description: Target Environment
  net:
    type: string
    enum:
      - 'net:home-net'
    default: 'net:home-net'
    title: Environment
    description: Target Environment  
resources:
  ansibleServer:
    type: Cloud.Machine
    properties:
      image: ansibleCentOS76
      flavor: ansibleMedium
      cloudConfig: |
        #cloud-config
        output: {all: '| tee -a /var/log/cloud-init-output.log'}
        runcmd:
        - ssh-keygen -t rsa -N "" -f /tmp/ansible-clients
      remoteAccess:
        authentication: usernamePassword
      constraints:
        - tag: '${input.cloud}'
        - tag: '${input.env}'
      networks:
        - name: '${resource.net.name}'
          network: '${resource.net.id}'
          assignment: static
          address: 192.168.1.22
  net:
    type: Cloud.Network
    properties:
      name: potterPublic
      networkType: existing
      constraints:
        - tag: '${input.net}'
